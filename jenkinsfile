pipeline {
           agent any
           stages {
                stage("Hello") {
                     steps {
                          
    
    sh("cloud auth  activate-service-account admin-demo@sapient-stacker-344918.iam.gserviceaccount.com --key-file=/home/averboonen/Llaves/sapient-stacker-344918-2a08df5bbf50.json")
                          script {
               currentBuild.displayName = sh (script: 'git log -1 --pretty=%B ${GIT_COMMIT}', returnStdout: true).trim()
                        }        
                         echo "Hello World"
                         sh 'export GOOGLE_APPLICATION_CREDENTIALS="/home/averboonen/Llaves/sapient-stacker-344918-2a08df5bbf50.json" '
                     }
                }
                 stage("TERRA") {
                     steps {
                          sh '/home/averboonen/google-cloud-sdk/bin/gcloud auth activate-service-account --key-file="/home/averboonen/Llaves/sapient-stacker-344918-2a08df5bbf50.json"'
                          //sh '/home/averboonen/google-cloud-sdk/bin/gcloud auth application-default login'
                         //sh 'terraform init'
                          // sh 'terrafor plan'
                     }
                }
                stage("Mover Archivo") {
                     steps {
                          script {
                         //touch "archivo_prueba$(date +_%Y%m%d_%H%M).txt"
                         sh '/home/averboonen/google-cloud-sdk/bin/gcloud config set core/project alex-verboonen-2022-run-5'
                         sh '/home/averboonen/google-cloud-sdk/bin/gcloud pubsub subscriptions pull example-subscription --format=json >> "archivo_prueba$(date +_%Y%m%d_%H%M).txt"'
                         sh '/home/averboonen/google-cloud-sdk/bin/gsutil cp "archivo_prueba$(date +_%Y%m%d_%H%M).txt" gs://bucket-alexverb-task1'
                          }
                     }
                }
           }
      }
